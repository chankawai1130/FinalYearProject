<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style type="text/css">
    #search-form {
        /* display: inline-block; */
        padding-top: 4px;
        padding-right: 5px;
        float: right;
    }

    #search-form input {

        width: 200px;
        height: 50px;
        float: left;
        border-radius: 2px 0 0 2px;
        font-size: 13px;
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;

        outline: 0;
        font-size: 100%;
        font: inherit
    }

    #search-field {
        border: 2px solid #F5F5F5;
    }

    #button-submit {
        width: auto !important;
        float: right;
        border-radius: 0 2px 2px 0;
        background: #8AA0AB;
        font-size: 13px;
        font-weight: 600;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.3);
        color: #fff;
        border: 2px solid #8AA0AB;
    }

    .topnav {
        overflow: hidden;
        background-color: #F5F5F5;
        width: 1140px;
        justify-content: center;
        margin: 0 auto;


        border-radius: 0px;
        position: static;
    }

    .topnav {
        overflow: hidden;
        background-color: #f0f0f0;
        width: 100%;
        justify-content: center;
        margin: 0 auto;
        padding-left: 110px;
        border-radius: 0px;
        position: static;
    }

    .topnav a {
        float: left;
        color: #000;
        text-align: center;
        padding: 14px 16px;
        text-decoration: none;
        font-size: 17px;
    }

    .topnav a:hover:not(.active) {
        background-color: rgb(218, 218, 218);
        color: #000;
    }

    .topnav a:hover,
    .topnav a:focus {
        text-decoration: underline;
    }

    .topnav a.active {
        /* background-color:#697174; */
        /* background-color:#717A7D; */
        background-color: #8AA0AB;
        color: white;
    }

    body {
        background: #e0ded6;
        font-family: "Helvetica Neue", Helvetica, Arial;
    }

    table {
        border-collapse: collapse;
        width: 100%;
    }

    th,
    td {
        text-align: left;
        padding: 8px;
    }

    .modalBtn {
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        cursor: pointer;
        width: 100%;
        opacity: 0.9;
    }

    .modalBtn:hover {
        opacity: 1;
    }

    .addBtn {
        /* background: #A3B82B; */
        background: #C4C491;
        width: 25%;
        margin-left: 325px;
        padding: 10px 0px;
        border-radius: 2px;
    }

    .confirmbtn:focus,
    .deletebtn:focus {
        color: black;
    }

    .cancelbtn,
    .deletebtn,
    .confirmbtn {
        float: left;
        width: 50%;
    }

    .cancelbtn {
        background-color: #ccc;
        color: black;
    }

    .deletebtn {
        background-color: #f44336;
    }

    .confirmbtn {
        background-color: #51A387;
    }

    .modal-container {
        padding: 16px;
        text-align: center;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 3;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(8, 8, 8, 0.5);
        padding-top: 50px;
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto 15% auto;
        border: 1px solid #888;
        width: 80%;
        font-family: "Helvetica Neue", Helvetica, Arial;
    }

    .interviewModal-content {
        background-color: #fefefe;
        margin: 5% auto 15% auto;
        border: 1px solid #888;
        width: 64%;
        font-family: "Helvetica Neue", Helvetica, Arial;
    }

    .clearfix::after {
        content: "";
        clear: both;
        display: table;
    }

    @media screen and (max-width: 300px) {

        .cancelbtn,
        .deletebtn .confirmbtn {
            width: 100%;
        }
    }

    .fa-calendar {
        /* color: #C0C0C0; */
        color: #7F7F7F;
    }

    .fa-calendar:hover {
        color: #666666;
    }

    .separator {
        content: '';
        display: inline-block;
        background: #e0dfdf;
        margin-left: 16px;
        margin-right: 4px;
        height: 38px;
        width: 1px;
        vertical-align: top;
    }

    #selectDateBtn {
        display: inline;
        width: 20px;
        height: 20px;
        border: 0px;
        background: #FFFFFF;
        padding: 0px;
        margin-right: 4px;
        outline: none !important;
        box-shadow: none !important;
    }

    #selectDateBtn:hover,
    #selectDateBtn:focus {
        border: 0px;
    }

    #interviewDate {
        background: #FFFFFF;
        width: 206px;
        border-radius: 4px;
        border: 1px solid #e0dfdf;
        margin-top: 15px;
        padding-top: 0px;
        margin-left: 0px;
        padding-right: 0px;
    }

    #searchField {
        margin-right: 5px;
        border-radius: 2px;
        width: 270px;
    }

    #searchBtn {
        background-color: #FEFAFF;
        color: #666666;
        border-radius: 2px;
        width: 70px;
        font-size: 17px;
        padding: 0px !important;
    }

    #searchBtn:hover,
    :focus {
        background-color: #F9F5FA;
    }

    #sendEmail:hover {
        background-color: #F9F5FA;
    }

    #sendEmail {
        display: none;
        background-color: #FEFAFF;
        color: #666666;
        border-radius: 2px;
        width: 95px;
        margin-bottom: 10px;
        margin-right: 5px;
        font-size: 14px;
        padding: 4px 9px 4px;
    }

    #scheduleInterview {
        display: none;
        background-color: #FEFAFF;
        color: #666666;
        border-radius: 2px;
        width: 145px;
        margin-bottom: 10px;
        font-size: 14px;
        padding: 4px 9px 4px;
    }

    #scheduleInterview:hover,
    :focus {
        background-color: #F9F5FA;
    }

    #approveBtn {
        width: 135px;
        /* background-color: #38BA7D; */
        /* background-color: #66A182; */
        background-color: #869A85;
        color: #fff;
        font-weight: lighter;
        margin-bottom: 5px;
        opacity: 0.9;
    }

    #disapproveBtn {
        width: 135px;
        font-weight: lighter;
        /* background-color: #F34541; */
        background-color: #F16C6D;
        color: #fff;
        opacity: 0.9;
    }

    #disapproveBtn:hover {
        opacity: 1;
    }

    #approveBtn:hover {
        opacity: 1;
    }

    #statusContainer {
        margin-right: 30px;
        padding: 6px 13px;
        /* background-color: #89837A; */
        text-align: center;
        display: inline;
        border-radius: 20px;
        /* background-image: linear-gradient(#a39c92, #b6b0a6); */
        /* color: #fff; */
        background-color: #cfc9be;
        color: #52504d;
        font-weight: 500;
        opacity: 0.9;
        text-shadow:
            0px 0px 3px rgba(255, 255, 255, 0.3),
            0px 0px 0px rgba(8, 8, 8, 0);
    }
</style>

<div class="wrapper" style="width: 100%;">
    <div class="container-fluid no-gutters"
        style="position: static; text-align: right; margin: 8px 0px; font-size: 14px;">

        <% if (req.session.role !=undefined) {%>
            Logged in as <b><%= req.session.user.Surname%> <%= req.session.user.GivenName%>
            </b>&nbsp; |&nbsp;
            <a style="color: black; padding: 5px 50px 25px 0px; color: #71838C" href="/user/logout">Logout</a>
        <%}%>
        
    </div>
</div>

<div class="wrapper" style="width: 100%; margin: 0 auto;">
    <div class="container-fluid" style="justify-content: center; 
    padding: 27px 15px 12px 115px; background: #fff;
    border-radius: 0px; position: static;">
        <h2 style="font-size: 40px;
            font-weight: bold; color:#6A635A">HKBU Student Admission System</h2>
    </div>
</div>

<div class="topnav">
    <a class="active" href="/user/admin/applications/all/search">Applications</a>
    <a href="/user/admin/statistics">Statistics</a>
    <a href="/user/admin/profile">Profile</a>
</div>

<div class="wrapper" style="width: 100%; margin: 0 auto;">
    <div class="container-fluid"
        style="justify-content: center; height: 35px; font-size: 17px;
background: #fff; border-radius: 0px; position: static; color: #888888; padding-top: 6px; padding-bottom: 5px; padding-left: 125px;">
        <i class="fa fa-home" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<i class="fa fa-angle-right"
            aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;<span>Applications</span>&nbsp;&nbsp;
    </div>
</div>
<br>
<div class="wrapper" style="width: 1310px; margin: 0 auto;">
    <div class="container-fluid" style="justify-content: center; 
    margin: 0 auto;  padding: 30px 15px 25px; background: #fff;
    border-radius: 0px; position: static;">

        <div style="display: flex;">

            <div class="main-content" style="margin-left: 40px;">
                <h3 style="color: #333333;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;">Applications
                </h3>

                <div>
                    <div style="margin-bottom: 10px; float: left">
                        <span style="padding-left: 3px; font-weight: 600;"><a href="/user/admin/applications/all/search" style="color:#6d8c9c;"> All
                            </a></span><span style="color: #9b9696;">(<%= allNum%>) |</span>
                        <span style="padding-left: 3px; font-weight: 600;"><a href="/user/admin/applications/approved/search" style="color:#6d8c9c;">
                                Approved
                            </a></span><span style="color: #9b9696;">(<%= approvedNum%>) |</span>
                        <span style="color: #333333;"><b>Dispproved </b></span><span style="color: #9b9696;">(<%=
                                disapprovedNum%>)
                                |</span>
                    </div>

                    <div style="float: right;">
                        <div class="form-inline">
                            <form action="/user/admin/applications/disapproved/search" method="GET">
                                <input type="text" id="searchField" class="form-control input-lg"
                                    value="<%= req.query.sApplication %>" name="sApplication"
                                    placeholder="Search applications">
                                <button type="submit" id="searchBtn" class="form-control btn-lg">Search</button>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-left: 0px; clear: both">
                    <!-- send email button -->
                    <button class="form-control btn-lg" id="sendEmail">Send Email</button>
                    <!-- select interview time slot button -->
                    <button class="form-control btn-lg" id="scheduleInterview">Schedule Interview</button>
                    <p id="blank"><br></p>
                </div>

                <table style="width: 1190px;">

                    <!-- table header -->
                    <tr style="border-bottom: 1px solid #f1f1f1; color: #666666; font-weight: 500;">
                        <td><input type="checkbox" id="select-all"></td>
                        <td>Application No.</td>
                        <td>Applicant Name</td>
                        <td>Applicant Email</td>
                        <td style="text-align: center;  padding-right: 36px;">Status</td>
                        <!-- <td>Scheduled Interview Date/ Time</td> -->
                        <td>Action</td>
                    </tr>
                    <!-- end -->
                    <% applications.forEach( function(model) { %>
                        <tr style="height: 70px; border-bottom: 1px solid #f1f1f1;">
                            <td width="2%"><input type="checkbox" id="checkbox<% model.id %>" name="select-applications"
                                    onclick="showContent();">
                            </td>
                            <td width="14%"><a href="#" style="color:#4677B6; font-weight: 600;">
                                    <%= model.idCode%>
                                </a>
                            </td>
                            <td width="16%">
                                <%= model.Surname%>
                                    <%= model.GivenName%>
                            </td>
                            <td width="18%" style="color:#3D70B3;">
                                <%= model.Email %>
                            </td>
                            <!-- 13/01/2021 &nbsp 01:59 AM-->
                            <td width="16%" style="text-align: center; ">
                                <div class="container" id="statusContainer">
                                    <% if (model.status == "submitted") { %>
                                    <span>
                                        Submitted
                                    </span>
                                    <% } else if (model.status == "approved") { %>
                                        <span>
                                            Approved
                                        </span>
                                        <% } else if (model.status == "disapproved") { %>
                                        <span>
                                            Disapproved
                                        </span>
                                        <% } %>
                                </div>
                            </td>

                            <td width="15%">
                                <% if (model.status=='submitted' ) { %>
                                    <!-- approve button -->
                                    <button class="form-control" id="approveBtn"
                                        onclick="document.getElementById('approveModal').style.display='block'"><i
                                            class="fa fa-check" aria-hidden="true"></i> APPROVE</button>

                                    <!-- confirm box -->
                                    <div id="approveModal" class="modal">
                                        <div class="modal-content">
                                            <div class="modal-container">
                                                <!-- modal-header -->
                                                <h1>Approve Application?</h1>
                                                <h4 style="margin-bottom: 20px;">(Application No.: <%= model.idCode%>)
                                                </h4>
                                                <!-- modal-body -->
                                                <p>Are you sure you want to approve this application?</p>
                                                <div class="clearfix">
                                                    <button type="button" class="cancelbtn modalBtn"
                                                        onclick="document.getElementById('approveModal').style.display='none'">
                                                        Cancel</button>
                                                    <button type="button" class="confirmbtn modalBtn"
                                                        onclick="approveApplication('<%= model.id%>')">Approve</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end -->

                                    <!-- disapprove button -->
                                    <button class="form-control" id="disapproveBtn"
                                        onclick="document.getElementById('disapproveModal').style.display='block'"><i
                                            class="fa fa-times" aria-hidden="true"></i> DECLINE</button>

                                    <!-- confirm box -->
                                    <div id="disapproveModal" class="modal">
                                        <div class="modal-content">
                                            <div class="modal-container">
                                                <h1>Disapprove Application?</h1>
                                                <h4 style="margin-bottom: 20px;">(Application No.: <%= model.idCode%>)
                                                </h4>
                                                <p>Are you sure you want to disapprove this application?</p>
                                                <div class="clearfix">
                                                    <button type="button" class="cancelbtn modalBtn"
                                                        onclick="document.getElementById('disapproveModal').style.display='none'">
                                                        Cancel</button>
                                                    <button type="button" class="deletebtn modalBtn"
                                                        onclick="disapproveApplication('<%= model.id%>')">
                                                        Disapprove</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- end -->
                                    <% } %>

                                        <% if (model.status=='approved' ) { %>
                                            <div style="width: 120px;">--</div>
                                            <% } %>

                                                <% if (model.status=='disapproved' ) { %>
                                                    <div style="width: 120px;">--</div>
                                                    <% } %>
                            </td>
                            <!-- <td><a style="color:#0089CB;" href="#">Approve</a> | <a style="color:#0089CB;" href="#">Disapprove</a></td> -->
                        </tr>
                        <% }); %>
                </table>

                <br>
                <div>
                    <!-- current page -->
                    <% const current=parseInt(req.query.page) || 1; %>

                    <% if (disapprovedNum != 0) { var start = 10 * (current - 1) + 1 } else { var start = 0 }%>  

                    <% var end =  10 * (current - 1) + disapprovedNum % 10 %>  

                    <% if (qdisapprovedNum != 0) { var qstart = 10 * (current - 1) + 1 } else { var qstart = 0 }%>  

                    <% var qend =  10 * (current - 1) + qdisapprovedNum % 10 %>  

                    <% if (req.query.sApplication =="" || !req.query.sApplication) { %>

                    <% if (disapprovedNum==0) { %>
                        <span style="color: #666666;">Showing 0 to <%=end %> of <%=disapprovedNum %> entries</span>
                        <% } else { %>
                            <span style="color: #666666;">Showing <%=start %> to <%=end %> of <%=disapprovedNum %> entries</span>
                            <%　}　%>

                            <%　} else {　%>

                                <% if (qdisapprovedNum==0) { %>
                                    <span style="color: #666666;">Showing 0 to <%=qend %> of <%=qdisapprovedNum %> entries</span>
                                    <% } else { %>
                                        <span style="color: #666666;">Showing <%=qstart %> to <%=qend %> of <%=qdisapprovedNum %> entries</span>
                                        <%　}　%>

                                <%　}　%>
                        <div style="float: right;">
                            <div class="form-inline">
                                <nav aria-label="Page navigation example">
                                    <ul class="pagination justify-content-end">
                                        <li class="page-item">
                                            <a class="page-link" style="color:#8AA0AB;"
                                                href="/user/admin/applications/disapproved/search/?page=<%= Math.max(current-1, 1) %>&sApplication=<%= req.query.sApplication %>"><span
                                                    aria-hidden="true">&laquo;</span></a>
                                        </li>

                                        <% for (i=1; i <=count; i++) { %>
                                            <% if (i==current) {%>
                                                <li class="page-item">
                                                    <a class="page-link" style="background-color: #8AA0AB; color: white; opacity: 0.7;"
                                                        href="/user/admin/applications/disapproved/search/?page=<%= i %>&sApplication=<%= req.query.sApplication %>">
                                                        <%= i %>
                                                    </a>
                                                </li>
                                                <% } else {%>
                                                    <li class="page-item">
                                                        <a class="page-link" style="color:#8AA0AB;"
                                                            href="/user/admin/applications/disapproved/search/?page=<%= i %>&sApplication=<%= req.query.sApplication %>">
                                                            <%= i %>
                                                        </a>
                                                    </li>
                                                    <% } %>
                                                        <% } %>

                                                            <li class="page-item">
                                                                <a class="page-link" style="color:#8AA0AB;"
                                                                    href="/user/admin/applications/disapproved/search/?page=<%= Math.min(current+1, count) %>&sApplication=<%= req.query.sApplication %>"><span
                                                                        aria-hidden="true">&raquo;</span></a>
                                                            </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>

            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('select-all').onclick = function () {
        var checkboxes = document.getElementsByName('select-applications');
        for (var checkbox of checkboxes) {
            checkbox.checked = this.checked;
        }
        showContent();
    }
</script>

<script>
    async function disapproveApplication(id) {

        var response = await fetch("/applications/disapprove/" + id, {
            method: "POST",
            credentials: 'same-origin',
        });

        if (response.ok) {
            var data = await response.json();
            alert(data.message);
            location.reload();
        } else {
            alert(response.status + ": " + response.statusText);
        }
    };  
</script>

<script>
    async function approveApplication(id) {

        var response = await fetch("/applications/approve/" + id, {
            method: "POST",
            credentials: 'same-origin',
        });
        if (response.ok) {
            var data = await response.json();
            alert(data.message);
            location.reload();
        } else {
            alert(response.status + ": " + response.statusText);
        }
    };
</script>

<script>
    async function scheduleInterview(id) {

        var response = await fetch("/applications/scheduleInterview/" + id, {
            method: "POST",
            credentials: 'same-origin',
        });
        if (response.ok) {
            var data = await response.json();
            alert(data.message);
            location.reload();
        } else {
            alert(response.status + ": " + response.statusText);
        }
    };
</script>

<script>
    function showContent() {

        var checkboxs = document.getElementsByName("select-applications");
        var visibility = "none";
        for (var i = 0; i < checkboxs.length; i++) {
            if (checkboxs[i].checked) {
                visibility = "block";
                break;
            }
        }
        document.getElementById("sendEmail").style.display = visibility;
        document.getElementById("scheduleInterview").style.display = visibility;
    }
</script>