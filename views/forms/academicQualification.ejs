<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<script src="https://kit.fontawesome.com/a076d05399.js"></script>

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<style type="text/css">
    .main-nav-ul ul a:before {
        content: '\203A';
        margin-right: 20px;
    }

    .sub-arrow-selected:after {
        content: '\203A';
        float: right;
        margin-right: 20px;
        transform: rotate(90deg);
    }

    .sub-arrow:after {
        content: '\203A';
        float: right;
        margin-right: 20px;
    }

    body {
        background: #e0ded6;
        font-family: "Helvetica Neue", Helvetica, Arial;
        padding-top: 20px;
    }

    ul {
        list-style-type: none;
        margin: 0;
        padding: 0;
        width: 250px;
        background-color: #f1f1f1;
    }

    li a {
        display: block;
        color: #000;
        padding: 8px 16px;
        text-decoration: none;
    }

    #lv1_selected {
        background-color: #8AA0AB;
        color: white;
    }

    #lv2_selected {
        background-color: #FCFEFE;
        color: #000;
    }

    a:hover:not(.active) {
        background-color: rgb(218, 218, 218);
        color: #000;
    }

    #saveContinue_Btn {
        background: -moz-linear-gradient(top,
                #b9c5dd 0%,
                #ACB9CA);
        background: -webkit-gradient(linear, left top, left bottom,
                from(#b9c5dd),
                to(#ACB9CA));
        color: #000;
        border: 2px solid #ACB9CA;
    }

    #saveContinue_Btn:hover {
        background: -moz-linear-gradient(top,
                #ACB9CA 0%,
                #b9c5dd);
        background: -webkit-gradient(linear, left top, left bottom,
                from(#ACB9CA),
                to(#b9c5dd));
    }

    #addRecord_Btn {
        background-color: #C5C4B0;
        color: #000;
        border-color: #aca979;
    }

    #addRecord_Btn:hover {
        background-color: #acab9a;
        color: #000;
        border-color: #aca979;
    }

    table,
    th,
    td {
        border: 2px solid;
        border-collapse: collapse;
        border-color: #f6f6f6;
        font-size: 16px
    }

    .table-content {
        padding: 4px 10px;
        text-align: center;
    }

    #saveBtn {
        background: -moz-linear-gradient(top,
                #D8D8D8 0%,
                #C9C9C9);
        background: -webkit-gradient(linear, left top, left bottom,
                from(#D8D8D8),
                to(#C9C9C9));
        /* background: #D8D8D8; */
        color: #000;
        border: 2px solid #D8D8D8;
    }

    #saveBtn:hover {
        background: -moz-linear-gradient(top,
                #C9C9C9 0%,
                #D8D8D8);
        background: -webkit-gradient(linear, left top, left bottom,
                from(#C9C9C9),
                to(#D8D8D8));
    }

    #removeRow {
        display: inline;
        font-size: 24px;
        width: 20px;
        height: 20px;
        border: 0px;
        padding: 0px;
        margin-right: 4px;
        outline: none !important;
        box-shadow: none !important;
    }
</style>

<%- partial('../partials/_logout.ejs') %>

<div class="container" style="width: 1140px;  justify-content: center; 
    margin: 0 auto; padding: 30px 15px 25px; background: #fff;
    border-radius: 0px; position: static;">
    <article class="page">
        <div style="display: flex;">

            <%- partial('../partials/_navbar.ejs') %>

            <form id="academicQualification" action="/forms/academicQualification" method="POST">

                <div class="main-content" style="margin-left: 40px">
                    <h3 style="color: #333333;
                            font-size: 24px;
                            font-weight: bold;
                            margin-bottom: 5px;">Academic Qualification</h3>

                    <table id="examResults" style="color: #333333; margin-top: 15px; width: 800px;">
                        <tr>
                            <td colspan="5" style="padding-left: 12px; background: #C8D8CC; margin-top: 15px; width: 800px; padding-top: 1px;
                        margin-left: 0px;">Public Examination Results</td>
                        </tr>
                        <tr style="background-color: #f6f6f6">
                            <td width="15%" style="text-align: center; padding: 5px 0;">Year</td>
                            <td width="30%" style="text-align: center;">Examination</td>
                            <td width="25%" style="text-align: center;">Subject</td>
                            <td width="20%" style="text-align: center;">Achieved Grade</td>
                            <td width="10%" style="text-align: center;">Action</td>
                        </tr>
                        <tr>
                            <td class="table-content">
                                <select class="form-control" name="AcademicQualification[examYear]" id="examYear"
                                    style="height: 30px; font-size: 15px;" required>
                                </select>
                            </td>
                            <td class="table-content">
                                <select class="form-control" name="AcademicQualification[examName]" id="examName"
                                    style="height: 30px; font-size: 15px;" required>
                                </select>
                            </td>
                            <td class="table-content">
                                <select class="form-control" name="AcademicQualification[subject]" id="subject"
                                    style="height: 30px; font-size: 15px; " required>
                                </select>
                            </td>
                            <td class="table-content">
                                <select class="form-control" name="AcademicQualification[grade]" id="grade"
                                    style="height: 30px; font-size: 15px; " required>
                                </select>
                            </td>
                            <td class="table-content">

                                <button type="button" class="form-control" onclick="deleteRow(this)" id="removeRow"><i
                                        class="fa fa-trash-o" aria-hidden="true"></i></button>
                            </td>
                        </tr>
                    </table>

                    <div>
                        <br>
                        <button type="button" id="addRecord_Btn" class="btn btn-primary" style="font-size: 15px;"
                            onclick="addRow()">
                            <b>Add Record</b></button>
                    </div>

                    <div>
                        <br>
                        <br>
                        <!-- Save -->
                        <button type="submit" id="saveBtn" class="btn btn-primary"
                            formaction="/forms/academicQualification/save"><b>Save</b></button>

                        <!-- Continue -->
                        <button type="submit" id="saveContinue_Btn" class="btn btn-primary">
                            <b>Save and Continue</b></button>
                    </div>
                </div>
            </form>
        </div>
    </article>
</div>

<script>
    (function () {
        var table = document.getElementById("examResults");
        var rowCount = table.rows.length;
        var row = table.insertRow(rowCount);

        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.examName != null) { %>'
        var examArr = '<%= req.session.academicQualificationData.AcademicQualification.examName %>';
        '<% } %>'


        var splitExamArr = examArr.split(",");

        //show up
        for (i = 1; i < splitExamArr.length; i = i + 1) {

            table.innerHTML = table.innerHTML + '<td class="table-content"><select class="form-control" id="examYear' + i + '" name="AcademicQualification[examYear]" style="height: 30px; font-size: 15px;"></select></td><td class="table-content"><select class="form-control" id="examName' + i + '" style="height: 30px; font-size: 15px;" name="AcademicQualification[examName]"></select></td><td class="table-content"><select class="form-control" id="subject' + i + '" name="AcademicQualification[subject]" style="height: 30px; font-size: 15px;"></select></td><td class="table-content"><select class="form-control" id="grade' + i + '" name="AcademicQualification[grade]" style="height: 30px; font-size: 15px;"></select></td><td class="table-content"><button class="form-control" onclick="deleteRow(this)" id="removeRow"><i class="fa fa-trash-o" aria-hidden="true"></i></button></td>'

            //set examYear option
            var todayYear = new Date().getFullYear();
            var start = todayYear;
            var end = 1944;
            var yearOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";

            for (var year = start; year >= end; year--) {
                yearOptions += "<option id='" + year + "" + i + "'>" + year + "</option>";
            }

            document.getElementById("examYear" + i).innerHTML = yearOptions;

            document.getElementById("examYear" + i).setAttribute('required', '');

            //retrieve the input - examYear
            '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.examYear != null) { %>'
            var yearArr = '<%= req.session.academicQualificationData.AcademicQualification.examYear %>';
            '<% } %>'


            var splitYearArr = yearArr.split(",");

            for (var year = start; year >= end; year--) {

                if (splitYearArr[i] == year) {

                    document.getElementById(year + "" + i).setAttribute('selected', 'selected');
                }
            }


            //set examName option
            var examOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";
            var exam = ["Hong Kong Diploma of Secondary Education", "Hong Kong Certificate of Exam", "Hong Kong A-Level Examination"]
            for (j = 0; j < exam.length; j = j + 1) {
                examOptions += "<option id='" + exam[j] + i + "'>" + exam[j] + "</option>";
            }

            document.getElementById("examName" + i).innerHTML = examOptions;

            document.getElementById("examName" + i).setAttribute('required', '');


            //populate select field - examName
            for (k = 0; k < exam.length; k = k + 1) {

                if (splitExamArr[i] == exam[k]) {

                    document.getElementById(exam[k] + i).setAttribute('selected', 'selected');
                }
            }


            //set subject options
            var subjectOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";
            var subjects = ["Biology", "Business and Accounting and Financial Studies", "Chemistry", "Chinese History", "Chinese Language", "Chinese Literature",
                "Combined Science", "Design and Applied Technology", "Economics", "English Language", "Ethics and Religious Studies", "Geography",
                "Health Management and Social Care", "History", "Information and Communication Technology", "Integrated Science",
                "Literature in English", "Mathematics", "Music", "Physical Education", "Physics", "Technology and Living", "Tourism and Hospitality Studies",
                "Visual Arts"
            ]

            for (j = 0; j < subjects.length; j = j + 1) {
                subjectOptions += "<option id='" + subjects[j] + i + "'>" + subjects[j] + "</option>";
            }

            document.getElementById("subject" + i).innerHTML = subjectOptions;

            document.getElementById("subject" + i).setAttribute('required', '');

            //retrieve the input - subject
            '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.subject != null) { %>'
            var subjectArr = '<%= req.session.academicQualificationData.AcademicQualification.subject %>';
            '<% } %>'

            var result = subjectArr.split(",");

            for (k = 0; k < subjects.length; k = k + 1) {

                if (result[i] == subjects[k]) {

                    document.getElementById(subjects[k] + i).setAttribute('selected', 'selected');
                }
            }

            //set grade option
            var gradeOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";

            var grades = ["5**", "5*", "5", "4", "3", "2", "1", "U"];

            for (j = 0; j < grades.length; j = j + 1) {
                gradeOptions += "<option id='" + grades[j] + i + "'>" + grades[j] + "</option>";
            }

            document.getElementById("grade" + i).innerHTML = gradeOptions;

            document.getElementById("grade" + i).setAttribute('required', '');

            //retrieve the input - grade

            '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.grade != null) { %>'
            var gradeArr = '<%= req.session.academicQualificationData.AcademicQualification.grade %>';
            '<% } %>'

            var splitGradeArr = gradeArr.split(",");

            for (k = 0; k < grades.length; k = k + 1) {

                if (splitGradeArr[i] == grades[k]) {

                    document.getElementById(grades[k] + i).setAttribute('selected', 'selected');
                }
            }
        }
    })();
</script>

<script>
    let count = 0;
    function addRow() {
        count++;
        var table = document.getElementById("examResults");
        var rowCount = table.rows.length;
        var row = table.insertRow(rowCount);

        //set exam year option
        var todayYear = new Date().getFullYear();
        var start = todayYear;
        var end = 1944;
        var yearOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";

        for (var year = start; year >= end; year--) {
            yearOptions += "<option id='" + year + "count" + count + "'>" + year + "</option>";
        }

        //column 1 - exam year
        var cell1 = row.insertCell(0);
        cell1.innerHTML = '<td><select class="form-control" id="examYear' + count + "count" + '" name="AcademicQualification[examYear]" style="height: 30px; font-size: 15px;"></select></td>';
        cell1.className = "table-content";

        document.getElementById("examYear" + count + "count").setAttribute('required', '');

        document.getElementById("examYear" + count + "count").innerHTML = yearOptions;

        //retrieve the input - examYear

        // '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.examYear != null) { %>'
        //     var yearArr = '<%= req.session.academicQualificationData.AcademicQualification.examYear %>';
        // '<% } %>'

        // var splitYearArr = yearArr.split(",");

        // for (var year = start; year >= end; year--) {

        //     if (splitYearArr[rowCount - 2] == year) {

        //         document.getElementById(year + "" + rowCount).setAttribute('selected', 'selected');
        //     }
        // }

        //set exam name option
        var examOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";
        var exam = ["Hong Kong Diploma of Secondary Education", "Hong Kong Certificate of Exam", "Hong Kong A-Level Examination"]
        for (i = 0; i < exam.length; i = i + 1) {
            examOptions += "<option id='" + exam[i] + "count" + count + "'>" + exam[i] + "</option>";
        }

        //column 2 - exam name
        var cell2 = row.insertCell(1);
        cell2.innerHTML = cell2.innerHTML + '<select class="form-control" id="examName' + count + "count" + '" style="height: 30px; font-size: 15px;" name="AcademicQualification[examName]"></select>';
        cell2.className = "table-content";

        document.getElementById("examName" + count + "count").setAttribute('required', '');

        document.getElementById("examName" + count + "count").innerHTML = examOptions;

        //retrieve the input - examName

        // '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.examName != null) { %>'
        //     var examArr = '<%= req.session.academicQualificationData.AcademicQualification.examName %>';
        // '<% } %>'

        // var splitExamArr = examArr.split(",");

        // for (i = 0; i < exam.length; i = i + 1) {

        //     if (splitExamArr[rowCount - 2] == exam[i]) {

        //         document.getElementById(exam[i] + rowCount).setAttribute('selected', 'selected');
        //     }
        // }

        //set subject options
        var subjectOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";
        var subjects = ["Biology", "Business and Accounting and Financial Studies", "Chemistry", "Chinese History", "Chinese Language", "Chinese Literature",
            "Combined Science", "Design and Applied Technology", "Economics", "English Language", "Ethics and Religious Studies", "Geography",
            "Health Management and Social Care", "History", "Information and Communication Technology", "Integrated Science",
            "Literature in English", "Mathematics", "Music", "Physical Education", "Physics", "Technology and Living", "Tourism and Hospitality Studies",
            "Visual Arts"
        ]

        for (i = 0; i < subjects.length; i = i + 1) {
            subjectOptions += "<option id='" + subjects[i] + "count" + count + "'>" + subjects[i] + "</option>";
        }


        //column 3 - subject
        var cell3 = row.insertCell(2);
        cell3.innerHTML = cell3.innerHTML + ' <select class="form-control" id="subject' + count + "count" + '" name="AcademicQualification[subject]" style="height: 30px; font-size: 15px;"></select>';
        cell3.className = "table-content";

        document.getElementById("subject" + count + "count").setAttribute('required', '');

        document.getElementById("subject" + count + "count").innerHTML = subjectOptions;

        //retrieve the input - subject

        // '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.subject != null) { %>'
        //     var subjectArr = '<%= req.session.academicQualificationData.AcademicQualification.subject %>';
        // '<% } %>'

        // var result = subjectArr.split(",");

        // for (i = 0; i < subjects.length; i = i + 1) {

        //     if (result[rowCount - 2] == subjects[i]) {

        //         document.getElementById(subjects[i] + rowCount).setAttribute('selected', 'selected');
        //     }
        // }

        //set grade option
        var gradeOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";

        var grades = ["5**", "5*", "5", "4", "3", "2", "1", "U"];

        for (i = 0; i < grades.length; i = i + 1) {
            gradeOptions += "<option id='" + grades[i] + "count" + count + "'>" + grades[i] + "</option>";
        }

        //column 4 - grade
        var cell4 = row.insertCell(3);
        cell4.innerHTML = cell4.innerHTML + ' <select class="form-control" id="grade' + count + "count" + '" name="AcademicQualification[grade]" style="height: 30px; font-size: 15px;"></select>';
        cell4.className = "table-content";

        document.getElementById("grade" + count + "count").setAttribute('required', '');

        document.getElementById("grade" + count + "count").innerHTML = gradeOptions;

        //retrieve the input - grade

        // '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.grade != null) { %>'
        //     var gradeArr = '<%= req.session.academicQualificationData.AcademicQualification.grade %>';
        // '<% } %>'

        // var splitGradeArr = gradeArr.split(",");

        // for (i = 0; i < grades.length; i = i + 1) {

        //     if (splitGradeArr[rowCount - 2] == grades[i]) {

        //         document.getElementById(grades[i] + rowCount).setAttribute('selected', 'selected');
        //     }
        // }

        //column 5 - remove row
        var cell5 = row.insertCell(4);
        cell5.innerHTML = cell5.innerHTML + ' <button class="form-control" onclick="deleteRow(this)" id="removeRow"><i class="fa fa-trash-o" aria-hidden="true"></i></button>';
        cell5.className = "table-content";

        // var cell1 = row.insertCell(5);
        // cell1.innerHTML = '<td>' + rowCount + '</td>';
    }

    function deleteRow(row) {
        var table = document.getElementById("examResults");
        var rowCount = table.rows.length;
        if (rowCount <= 4) {
            alert("Cannot delete all the rows")
        } else {
            var i = row.parentNode.parentNode.rowIndex;
            document.getElementById('examResults').deleteRow(i);
        }
    }
</script>

<script>
    (function () {
        //set year options
        var todayYear = new Date().getFullYear();
        var start = todayYear;
        var end = 1944;
        var yearOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";

        for (var year = start; year >= end; year--) {
            yearOptions += "<option id='" + year + "'>" + year + "</option>";
        }

        document.getElementById("examYear").innerHTML = yearOptions;


        //is an array
        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.examYear[0] != null) { %>'
        var selectedFirstYear = '<%= req.session.academicQualificationData.AcademicQualification.examYear[0] %>';
        '<% } %>'

        for (var year = start; year >= end; year--) {

            if (selectedFirstYear == year) {

                document.getElementById(year).setAttribute('selected', 'selected');
            }
        }

        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.examYear != null) { %>'
        var selectedYear = '<%= req.session.academicQualificationData.AcademicQualification.examYear %>';
        '<% } %>'

        for (var year = start; year >= end; year--) {

            if (selectedYear == year) {

                document.getElementById(year).setAttribute('selected', 'selected');
            }
        }
    })();
</script>

<script>
    (function () {
        //set exam name options
        var examOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";
        var exam = [
            "Hong Kong Diploma of Secondary Education",
            "Hong Kong Certificate of Exam",
            "Hong Kong A-Level Examination"]
        for (i = 0; i < exam.length; i = i + 1) {
            examOptions += "<option id='" + exam[i] + "'>" + exam[i] + "</option>";
        }

        document.getElementById("examName").innerHTML = examOptions;

        //is an array
        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.examName[0] != null) { %>'
        var selectedFirstExam = '<%= req.session.academicQualificationData.AcademicQualification.examName[0] %>';
        '<% } %>'

        for (i = 0; i < exam.length; i = i + 1) {

            if (selectedFirstExam == exam[i]) {

                document.getElementById(exam[i]).setAttribute('selected', 'selected');
            }
        }

        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.examName != null) { %>'
        var selectedExam = '<%= req.session.academicQualificationData.AcademicQualification.examName %>';
        '<% } %>'

        for (i = 0; i < exam.length; i++) {

            if (selectedExam == exam[i]) {

                document.getElementById(exam[i]).setAttribute('selected', 'selected');
            }
        }
    })();
</script>

<script>
    (function () {
        //set exam subject options
        var subjectOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";
        var subjects = ["Biology", "Business and Accounting and Financial Studies", "Chemistry", "Chinese History", "Chinese Language", "Chinese Literature",
            "Combined Science", "Design and Applied Technology", "Economics", "English Language", "Ethics and Religious Studies", "Geography",
            "Health Management and Social Care", "History", "Information and Communication Technology", "Integrated Science",
            "Literature in English", "Mathematics", "Music", "Physical Education", "Physics", "Technology and Living", "Tourism and Hospitality Studies",
            "Visual Arts"
        ]
        for (i = 0; i < subjects.length; i = i + 1) {
            subjectOptions += "<option id='" + subjects[i] + "'>" + subjects[i] + "</option>";
        }

        document.getElementById("subject").innerHTML = subjectOptions;

        //is an array
        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.subject[0] != null) { %>'
        var selectedFirstSubject = '<%= req.session.academicQualificationData.AcademicQualification.subject[0] %>';
        '<% } %>'

        for (i = 0; i < subjects.length; i = i + 1) {

            if (selectedFirstSubject == subjects[i]) {

                document.getElementById(subjects[i]).setAttribute('selected', 'selected');
            }
        }

        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.subject != null) { %>'
        var selectedSubject = '<%= req.session.academicQualificationData.AcademicQualification.subject %>';
        '<% } %>'

        for (i = 0; i < subjects.length; i = i + 1) {

            if (selectedSubject == subjects[i]) {

                document.getElementById(subjects[i]).setAttribute('selected', 'selected');
            }
        }
    })();
</script>

<script>
    (function () {
        //set grade option
        var gradeOptions = "<option selected disabled value=''>" + "-Select-" + "</option>";

        var grades = ["5**", "5*", "5", "4", "3", "2", "1", "U"];

        for (i = 0; i < grades.length; i++) {
            gradeOptions += "<option id='" + grades[i] + "'>" + grades[i] + "</option>";
        }
        document.getElementById("grade").innerHTML = gradeOptions;

        //is an array
        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.grade[0] != null) { %>'
        var selectedFirstGrade = '<%= req.session.academicQualificationData.AcademicQualification.grade[0] %>';
        '<% } %>'

        for (i = 0; i < grades.length; i = i + 1) {

            if (selectedFirstGrade == grades[i]) {

                document.getElementById(grades[i]).setAttribute('selected', 'selected');
            }
        }

        '<% if (req.session.academicQualificationData != null && req.session.academicQualificationData.AcademicQualification.grade != null) { %>'
        var selectedGrade = '<%= req.session.academicQualificationData.AcademicQualification.grade %>';
        '<% } %>'

        for (i = 0; i < grades.length; i++) {

            if (selectedGrade == grades[i]) {

                document.getElementById(grades[i]).setAttribute('selected', 'selected');
            }
        }
    })();
</script>